// Generated by CoffeeScript 1.6.3
(function() {
  var __slice = [].slice;

  exports.Event = (function() {
    function Event() {}

    Event.prototype.trigger = function() {
      var allEvents, args, events, name, _ref, _ref1;
      name = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      events = (_ref = this._events) != null ? _ref[name] : void 0;
      if (events != null) {
        this._triggerEvents.apply(this, [events].concat(__slice.call(args)));
      }
      allEvents = (_ref1 = this._events) != null ? _ref1.all : void 0;
      if (allEvents != null) {
        this._triggerEvents.apply(this, [allEvents, name].concat(__slice.call(args)));
      }
      return this;
    };

    Event.prototype.on = function(name, callback) {
      var events;
      if (this._events == null) {
        this._events = {};
      }
      if (/\s/g.test(name)) {
        throw Error('Illegal event name');
      }
      events = this._events[name] || (this._events[name] = []);
      events.push({
        callback: callback,
        self: this
      });
      return this;
    };

    Event.prototype.off = function(name, callback) {
      var event, events, key, names, newEvents, _i, _j, _len, _len1;
      if (callback == null) {
        this._events = {};
        return this;
      }
      events = this._events[name];
      names = name ? [name] : (function() {
        var _i, _len, _ref, _results;
        _ref = this._events;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          key = _ref[_i];
          _results.push(key);
        }
        return _results;
      }).call(this);
      for (_i = 0, _len = names.length; _i < _len; _i++) {
        name = names[_i];
        newEvents = [];
        this._events[name] = newEvents;
        for (_j = 0, _len1 = events.length; _j < _len1; _j++) {
          event = events[_j];
          if (callback !== event.callback) {
            newEvents.push(event);
          }
        }
        if (newEvents.length === 0) {
          delete this._events[name];
        }
      }
      return this;
    };

    Event.prototype._triggerEvents = function() {
      var args, event, events, _i, _len, _results;
      events = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      _results = [];
      for (_i = 0, _len = events.length; _i < _len; _i++) {
        event = events[_i];
        _results.push(event.callback.apply(event, args));
      }
      return _results;
    };

    return Event;

  })();

}).call(this);
// Generated by CoffeeScript 1.6.3
(function() {
  var _,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  _ = require('underscore');

  exports.Model = (function(_super) {
    __extends(Model, _super);

    function Model(attributes, options) {
      var properties;
      this._properties = {};
      this.cid = _.uniqueId('m');
      properties = attributes != null ? attributes : {};
      this.set(properties);
      if (typeof this.initialize === "function") {
        this.initialize(properties);
      }
    }

    Model.prototype.set = function(key, value) {
      var attributes, changeName, changedPropertyNames, current, idAttribute, isChanged, modelClass, name, options, previous, _i, _len, _ref, _ref1;
      idAttribute = 'id';
      if (typeof key === 'object') {
        attributes = key;
        options = value;
      } else {
        (attributes = {})[key] = value;
      }
      this._previousProperties = _.clone(this._properties);
      current = this._properties;
      previous = this._previousProperties;
      changedPropertyNames = [];
      this.changed = {};
      for (name in attributes) {
        value = attributes[name];
        if (name === idAttribute) {
          this[idAttribute] = value;
        }
        if (current[name] !== value) {
          changedPropertyNames.push(name);
        }
        if (previous[name] !== value) {
          this.changed[name] = value;
        }
        if (((_ref = current[name]) != null ? _ref.set : void 0) != null) {
          current[name].set(value);
        } else {
          if (current[name] == null) {
            modelClass = (_ref1 = this.models) != null ? _ref1[name] : void 0;
            if (modelClass != null) {
              value = new modelClass(value);
            }
          }
          if (value instanceof exports.Model) {
            if (value._parent == null) {
              value._parent = this;
              value.id = name;
              this[name] = value;
            }
          }
          current[name] = value;
        }
      }
      for (_i = 0, _len = changedPropertyNames.length; _i < _len; _i++) {
        changeName = changedPropertyNames[_i];
        this.trigger("change:" + changeName, this, current[changeName]);
      }
      isChanged = changedPropertyNames.length > 0;
      if (isChanged) {
        return this.trigger('change', this);
      }
    };

    Model.prototype.get = function(key) {
      return this._properties[key];
    };

    Model.prototype.unset = function(key) {
      var model;
      model = this._properties[key];
      delete this._properties[key];
      if (model != null) {
        if (typeof model.trigger === "function") {
          model.trigger('unset', model);
        }
      }
      return model != null ? typeof model.trigger === "function" ? model.trigger('remove', model) : void 0 : void 0;
    };

    Model.prototype.path = function() {
      var prefix, _ref;
      if (this._parent != null) {
        prefix = this._parent.path();
        return "" + prefix + "/" + this.id;
      } else {
        return (_ref = this.rootPath) != null ? _ref : '';
      }
    };

    Model.prototype.fetch = function() {
      return this.trigger('fetch', this);
    };

    Model.prototype.destroy = function() {
      return this.trigger('destroy', this);
    };

    return Model;

  })(exports.Event);

}).call(this);
// Generated by CoffeeScript 1.6.3
(function() {
  var _, _ref,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  _ = require('underscore');

  exports.Collection = (function(_super) {
    __extends(Collection, _super);

    function Collection() {
      _ref = Collection.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    Collection.prototype.add = function(object) {
      return this.set(object);
    };

    Collection.prototype.get = function(object) {
      if (object.id != null) {
        return Collection.__super__.get.call(this, object.id);
      } else if (object.cid != null) {
        return Collection.__super__.get.call(this, object.cid);
      } else {
        return Collection.__super__.get.call(this, object);
      }
    };

    Collection.prototype.set = function(objects) {
      var id, idAttribute, object, _i, _len, _results;
      objects = _.isArray(objects) ? objects : [objects];
      idAttribute = 'id';
      _results = [];
      for (_i = 0, _len = objects.length; _i < _len; _i++) {
        object = objects[_i];
        id = object[idAttribute];
        if (id != null) {
          Collection.__super__.set.call(this, id, object);
        }
        if (object instanceof exports.Model) {
          _results.push(Collection.__super__.set.call(this, object.cid, object));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Collection.prototype.remove = function(object) {
      if (object.id != null) {
        this.unset(object.id);
      }
      return this.unset(object.cid);
    };

    return Collection;

  })(exports.Model);

}).call(this);
